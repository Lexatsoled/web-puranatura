<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Sistema de Navegaci√≥n</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; }
        .success { background-color: #d4edda; }
        .error { background-color: #f8d7da; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üß™ Test Sistema de Navegaci√≥n Persistente</h1>
    
    <div class="test-section">
        <h3>üéØ Flujo de Test</h3>
        <ol>
            <li>Simular usuario en tienda (p√°gina 3, categor√≠a, scroll)</li>
            <li>Simular ir a producto</li>
            <li>Simular "Volver a la lista"</li>
            <li>Verificar que el estado se restore correctamente</li>
        </ol>
    </div>

    <div class="test-section">
        <h3>üíæ Estado SessionStorage</h3>
        <button onclick="simulateStoreNavigation()">1. Simular Navegaci√≥n en Tienda</button>
        <button onclick="simulateProductPage()">2. Ir a Producto</button>
        <button onclick="simulateBackToStore()">3. Volver a la Lista</button>
        <button onclick="clearState()">üóëÔ∏è Limpiar Estado</button>
        
        <div id="state-display" style="margin-top: 10px; padding: 10px; background: #f8f9fa;"></div>
    </div>

    <div class="test-section">
        <h3>üìç Scroll Position</h3>
        <button onclick="setScrollPosition(1200)">Simular Scroll en Posici√≥n 1200px</button>
        <button onclick="checkScrollPosition()">Verificar Posici√≥n Actual</button>
        
        <div id="scroll-display" style="margin-top: 10px; padding: 10px; background: #f8f9fa;"></div>
        
        <!-- Crear contenido para hacer scroll -->
        <div style="height: 2000px; background: linear-gradient(to bottom, #f0f0f0, #e0e0e0); margin-top: 20px;">
            <p style="text-align: center; padding-top: 50px;">Contenido largo para probar scroll</p>
            <div style="position: absolute; top: 1200px; left: 50%; transform: translateX(-50%); background: yellow; padding: 10px;">
                üìç Posici√≥n 1200px (donde debe volver el scroll)
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEY = 'puranatura_navigation_state';
        
        function updateDisplay() {
            const state = sessionStorage.getItem(STORAGE_KEY);
            document.getElementById('state-display').innerHTML = 
                state ? `<pre>${JSON.stringify(JSON.parse(state), null, 2)}</pre>` : 'No hay estado guardado';
        }

        function simulateStoreNavigation() {
            const storeState = {
                selectedCategory: 'vitaminas',
                searchTerm: 'B12',
                sortOption: 'name-asc',
                currentPage: 3,
                itemsPerPage: 12,
                scrollPosition: window.scrollY,
                fromProductPage: false
            };
            
            sessionStorage.setItem(STORAGE_KEY, JSON.stringify(storeState));
            updateDisplay();
            
            document.querySelector('.test-section').className = 'test-section success';
            alert('‚úÖ Estado de tienda simulado: Categor√≠a "vitaminas", p√°gina 3, b√∫squeda "B12"');
        }

        function simulateProductPage() {
            // Simular ir a p√°gina de producto - no cambiar el estado
            alert('üëÄ Simulando navegaci√≥n a p√°gina de producto...');
        }

        function simulateBackToStore() {
            const currentState = JSON.parse(sessionStorage.getItem(STORAGE_KEY) || '{}');
            if (currentState) {
                currentState.fromProductPage = true;
                sessionStorage.setItem(STORAGE_KEY, JSON.stringify(currentState));
                updateDisplay();
                
                alert('üîÑ Simulando "Volver a la lista" - Estado marcado con fromProductPage: true');
                
                // Simular lo que har√≠a el StorePage
                setTimeout(() => {
                    window.scrollTo({ top: currentState.scrollPosition, behavior: 'smooth' });
                    alert(`üìç Scroll restaurado a posici√≥n: ${currentState.scrollPosition}px`);
                }, 500);
            }
        }

        function clearState() {
            sessionStorage.removeItem(STORAGE_KEY);
            updateDisplay();
            alert('üóëÔ∏è Estado limpiado');
        }

        function setScrollPosition(pos) {
            window.scrollTo({ top: pos, behavior: 'smooth' });
            setTimeout(() => {
                checkScrollPosition();
            }, 1000);
        }

        function checkScrollPosition() {
            const pos = window.scrollY;
            document.getElementById('scroll-display').innerHTML = 
                `Posici√≥n actual del scroll: <strong>${pos}px</strong>`;
        }

        // Inicializar display
        updateDisplay();
        checkScrollPosition();

        // Actualizar posici√≥n de scroll en tiempo real
        window.addEventListener('scroll', () => {
            checkScrollPosition();
        });
    </script>
</body>
</html>