{
  "meta": {
    "version": 1,
    "severity_scale": ["info", "low", "medium", "high", "critical"],
    "status": "draft"
  },
  "findings": [
    {
      "id": "ARCH-001",
      "title": "Confusión de estructura de componentes",
      "category": "maintainability",
      "subcategory": "structure",
      "severity": "medium",
      "likelihood": 5,
      "priority": 15,
      "where": { "file": "src/components", "notes": "vs root /components" },
      "evidence": "Existen dos carpetas de componentes (root y src), lo que sugiere una migración incompleta o falta de convención.",
      "impact": "Dificultad de mantenimiento, duplicación de código y bundles más grandes.",
      "recommendation": "Consolidar todos los componentes bajo `src/components`.",
      "fix_example": "mv components/* src/components/ && rm -rf components",
      "references": ["React Folder Structure Best Practices"]
    },
    {
      "id": "SEC-PRIV-001",
      "title": "Almacenamiento potencial de PII (IP) sin hash",
      "category": "security",
      "subcategory": "gdpr",
      "severity": "high",
      "likelihood": 3,
      "priority": 12,
      "where": {
        "file": "backend/prisma/schema.prisma",
        "line": 86,
        "snippet": "userIp String?"
      },
      "evidence": "Modelo AnalyticsEvent tiene campo userIp. Si se guarda en crudo, viola privacidad en ciertas jurisdicciones.",
      "impact": "Incumplimiento GDPR/CCPA.",
      "recommendation": "Almacenar solo hash(ip + salt) o truncar el último octeto.",
      "fix_example": "userIp = sha256(req.ip + dailySalt)",
      "references": ["GDPR Data Minimization"]
    },
    {
      "id": "SEC-XSS-001",
      "title": "CSP 'trust proxy' con configuración por defecto",
      "category": "security",
      "subcategory": "configuration",
      "severity": "medium",
      "likelihood": 2,
      "priority": 6,
      "where": {
        "file": "backend/src/app.ts",
        "line": 22,
        "snippet": "app.set('trust proxy', 1);"
      },
      "evidence": "Se asume que hay 1 proxy delante. Si se despliega sin proxy, spoofing de IP es posible.",
      "impact": "Rate limiting bypass, logging incorrecto de IPs.",
      "recommendation": "Configurar via variable de entorno TRUST_PROXY_HOPS.",
      "fix_example": "app.set('trust proxy', parseInt(process.env.TRUST_PROXY || '1'))"
    },
    {
      "id": "CODE-COMPLEX-001",
      "title": "Componente AuthModal monolítico",
      "category": "maintainability",
      "subcategory": "complexity",
      "severity": "low",
      "likelihood": 5,
      "priority": 5,
      "where": { "file": "components/AuthModal.tsx", "lines": "1-587" },
      "evidence": "Más de 500 líneas mezclando validación, gestión de estado y UI.",
      "impact": "Difícil de testear y refactorizar.",
      "recommendation": "Extraer lógica a `useAuthForm` hook y separar subcomponentes (LoginForm, RegisterForm).",
      "fix_example": "const { register, formState } = useAuthForm();"
    },
    {
      "id": "UX-INT-001",
      "title": "Validación de email permisiva",
      "category": "ux",
      "subcategory": "validation",
      "severity": "low",
      "likelihood": 4,
      "priority": 4,
      "where": { "file": "components/AuthModal.tsx", "line": 60 },
      "evidence": "Regex /\\S+@\\S+\\.\\S+/ permite 'a@b.c' que podría no ser deseado.",
      "impact": "Errores de usuario al registrarse (typos).",
      "recommendation": "Usar librería robusta como Zod para validación isomórfica.",
      "fix_example": "z.string().email()"
    }
  ]
}
