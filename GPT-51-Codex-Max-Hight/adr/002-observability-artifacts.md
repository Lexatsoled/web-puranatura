# ADR-002: Evidencia de observabilidad empaquetada

- Estado: aceptada
- Fecha: 2025-11-26
- Contexto: la fase 4 del plan maestro exige evidencia recurrente de trazas, métricas y reportes de performance por cada gate; hasta ahora esa evidencia residía en archivos dispersos de `reports/observability`.
- Decisión: ejecutar los scripts `scripts/collect-metrics.ps1` y `scripts/package-observability-artifacts.ps1` durante el pipeline CI (`ci.yml`) inmediatamente después de `npm run perf:api` para refrescar `/metrics`, el log de spans y generar `reports/observability/observability-artifacts.zip` (con métricas, trazas, LHCI y Playwright). El ZIP y su carpeta `reports/observability/archive/` quedarán disponibles para QA/SRE y para adjuntar al gate T4.
- Consecuencias: el pipeline incurre en un tiempo adicional limitado y requiere `pwsh` 5.1 para ejecutar los scripts; los artefactos comprimidos ocupan espacio en el workspace (ahora 17MB) pero facilitan la revisión y la auditoría del gate. Si el build agenra errores no relacionados con observabilidad, aún podemos ejecutar los scripts manualmente para regenerar la evidencia.
- Plan de implementación: 1) mantener `backend/dist/server.js` compilado (ya cubierto por el step `npm --prefix backend run build` previo), 2) ejecutar `pwsh -NoProfile -ExecutionPolicy Bypass -File scripts/collect-metrics.ps1`, 3) ejecutar `pwsh -NoProfile -ExecutionPolicy Bypass -File scripts/package-observability-artifacts.ps1`, 4) archivar `reports/observability/observability-artifacts.zip` y su carpeta `archive/` junto a los demás artifacts del workflow (`actions/upload-artifact` ya recoge `reports/**`). Estos pasos ya están insertados en `.github/workflows/ci.yml`.
- Revisión futura: revaluar cuando la fase 5 avance lo suficiente para que este package se convierta en parte de un runbook de observabilidad (por ejemplo, cuando se necesite integrar con un operador de dashboards externo) o si el tamaño de los artefactos crece por encima de lo aceptable.
